---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { LANGS, type Lang, DEFAULT_LANG } from "../../../config/i18n";

export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang?: string };
const safeLang: Lang = LANGS.includes((lang as Lang) || ("" as Lang))
  ? (lang as Lang)
  : DEFAULT_LANG;

const BASE = import.meta.env.BASE_URL || '/';
const API_SUFFIX = import.meta.env.DEV ? 'index.html' : '';
const IFRAME_SRC = `${BASE}docs/api/${safeLang}/${API_SUFFIX}`;
const alternates = Object.fromEntries(
  LANGS.map((l: Lang) => [l, `${BASE}api/${l}/`])
) as Record<Lang, string>;
const abs = (href: string) => (Astro.site ? new URL(href, Astro.site).toString() : href);
---
<BaseLayout title="MindQuantum API" description="Reference API documentation" lang={safeLang}>
  <section>
    <iframe id="mq-docs-frame" src={IFRAME_SRC} title="MindQuantum API" loading="lazy" referrerpolicy="no-referrer-when-downgrade" />
  </section>
  <script>
    const iframe = document.getElementById('mq-docs-frame');
    const header = document.querySelector('.site-header');
    function sizeFrame() {
      const h = header ? header.offsetHeight : 0;
      iframe.style.height = `calc(100vh - ${h}px)`;
    }
    addEventListener('resize', sizeFrame);
    addEventListener('load', sizeFrame);
    sizeFrame();
  </script>
  <style>
    section { padding: 0; }
    #mq-docs-frame { width: 100%; border: 0; display: block; }
  </style>
</BaseLayout>
