---
import { LANGS, type Lang, DEFAULT_LANG } from "../../../config/i18n";

export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang?: string };
const safeLang: Lang = LANGS.includes((lang as Lang) || ("" as Lang))
  ? (lang as Lang)
  : "en";

const BASE = import.meta.env.BASE_URL || '/';
const SUFFIX = import.meta.env.DEV ? 'index.html' : '';
const target = `${BASE}docs/api/${safeLang}/${SUFFIX}`;
const alternates = Object.fromEntries(
  LANGS.map((l: Lang) => [l, `${BASE}docs/api/${l}/${SUFFIX}`])
) as Record<Lang, string>;
const abs = (href: string) => (Astro.site ? new URL(href, Astro.site).toString() : href);
Astro.redirect(target);
---
<!doctype html>
<html lang={safeLang}>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="refresh" content={`0; url=${target}`} />
    <link rel="canonical" href={abs(target)} />
    {Object.entries(alternates).map(([code, href]) => (
      <link rel="alternate" hreflang={code} href={abs(href)} />
    ))}
    <link rel="alternate" hreflang="x-default" href={abs(alternates[DEFAULT_LANG])} />
    <title>Redirecting…</title>
  </head>
  <body>
    <p>Redirecting to <a href={target}>API ({safeLang.toUpperCase()})</a>…</p>
  </body>
</html>
