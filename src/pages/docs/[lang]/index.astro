---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { LANGS, type Lang, START_PAGE, DEFAULT_LANG } from "../../../config/i18n";

// Generate static paths for all supported languages
export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

// Resolve language and the proper language start page
const { lang } = Astro.params as { lang?: string };
const safeLang: Lang = LANGS.includes((lang as Lang) || ("" as Lang))
  ? (lang as Lang)
  : DEFAULT_LANG;
const BASE = import.meta.env.BASE_URL || '/';
const target = `${BASE}${START_PAGE[safeLang].replace(/^\//, '')}`;
const alternates = Object.fromEntries(
  LANGS.map((l: Lang) => [l, `${BASE}docs/${l}/`])
) as Record<Lang, string>;
const abs = (href: string) => (Astro.site ? new URL(href, Astro.site).toString() : href);
---
<BaseLayout title="MindQuantum Docs" description="Guides and tutorials" lang={safeLang}>
  <section>
    <iframe id="mq-docs-frame" src={target} title="MindQuantum Docs" loading="lazy" referrerpolicy="no-referrer-when-downgrade" />
  </section>
  <script>
    const iframe = document.getElementById('mq-docs-frame');
    const header = document.querySelector('.site-header');
    function sizeFrame() {
      const h = header ? header.offsetHeight : 0;
      iframe.style.height = `calc(100vh - ${h}px)`;
    }
    addEventListener('resize', sizeFrame);
    addEventListener('load', sizeFrame);
    sizeFrame();
  </script>
  <style>
    section { padding: 0; }
    #mq-docs-frame { width: 100%; border: 0; display: block; }
  </style>
</BaseLayout>
